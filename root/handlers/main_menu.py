import asyncio

from aiogram import types
from aiogram.dispatcher import FSMContext
from aiogram.dispatcher.filters import Text

from config import dp, bot, base, admins

from keyboards.client import *
from states.client import *

@dp.message_handler(Text(["üìô–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é", "/start"]), state="*")
async def start_message(message: types.Message, state: FSMContext):
    await state.finish()
    if await base.user_exists(message.from_user.id):
        await message.answer("<b>üìí–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>", reply_markup=main_kb)
    else:
        await message.answer("<b>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º –≤–∞—Å –≤ –±–æ—Ç–µ Profpoint!</b>\n\n–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Å—Ç–∞—Ç—å ‚Äú—Ç–∞–π–Ω—ã–º –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º‚Äù –∫–æ–º–ø–∞–Ω–∏–∏ Profpoint!", reply_markup=first_kb)

@dp.callback_query_handler(Text("joinyes"))
async def join_message(call: types.CallbackQuery):
    await call.message.edit_text("–ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, –∫—Ç–æ —Ç–∞–∫–∏–µ ‚Äú–¢–∞–π–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏‚Äù, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–π –∏ —É–∑–Ω–∞—é—Ç –ø—Ä–∞–≤–¥—É –æ —Ä–µ–∞–ª—å–Ω–æ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º —Å–µ—Ä–≤–∏—Å–µ?", reply_markup=start_kb)

@dp.callback_query_handler(Text("start_no"))
async def join_message(call: types.CallbackQuery, state: FSMContext):
    await call.message.edit_text("""‚Äú–¢–∞–π–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å‚Äù - —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫, —Å–º—ã—Å–ª —Ä–∞–±–æ—Ç—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø–æ—Å–µ—â–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤, –æ—Ñ–∏—Å–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö —Ü–µ–Ω—Ç—Ä–æ–≤ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–¥ –≤–∏–¥–æ–º –æ–±—ã—á–Ω–æ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è.

–ü–µ—Ä–µ–¥ —É—á–∞—Å—Ç–∏–µ–º –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–∞–π–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂. –û–Ω–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É –∏ —Ä—è–¥ –≤–æ–ø—Ä–æ—Å–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –∏ –Ω—É–∂–Ω–æ –¥–∞—Ç—å –æ—Ç–≤–µ—Ç –ø–æ—Å–ª–µ –ø–æ—Å–µ—â–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π —Ç–æ—á–∫–∏. 

–ó–∞—Ç–µ–º —Ç–∞–π–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–¥ –≤–∏–¥–æ–º –æ–±—ã—á–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–µ—Ç—Å—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–º—É —Ç–æ–≤–∞—Ä—É/—É—Å–ª—É–≥–µ. –í–µ—Å—å –≤–∏–∑–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∏—Å–∞—Ç—å –Ω–∞ –¥–∏–∫—Ç–æ—Ñ–æ–Ω. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏ –¥–∏–∫—Ç–æ—Ñ–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å –ø–æ—á—Ç–∏ –≤ –∫–∞–∂–¥–æ–º –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

–ü–æ—Å–ª–µ –≤–∏–∑–∏—Ç–∞ —Ç–∞–π–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∞–Ω–∫–µ—Ç—É –∏ –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã: –∞—É–¥–∏–æ–∑–∞–ø–∏—Å—å, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ —Ç.–¥. –ó–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞. –ß–µ–º —à–∏—Ä–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞, —Ç–µ–º –≤—ã—à–µ –ø–ª–∞—Ç–∞ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫—É.

–ö–∞–∫ —Å—Ç–∞—Ç—å —Ç–∞–π–Ω—ã–º –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º? –í—Å–µ –ø—Ä–æ—Å—Ç–æ! –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É. –ì–æ—Ç–æ–≤—ã?""")
    await call.message.answer("<b>–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–µ –∏–º—è</b>")
    await FSMregistration.name.set()
    await asyncio.sleep(300)
    if await state.get_state() == FSMregistration.name and 'name' not in (await state.get_data()).keys():
        await call.message.answer("–¢—É–∫-—Ç—É–∫, –∫–∞–∂–µ—Ç—Å—è –≤—ã –ø—Ä–µ—Ä–≤–∞–ª–∏—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é")

@dp.callback_query_handler(Text("start_yes"))
async def start_registration(call: types.CallbackQuery, state: FSMContext):
    await call.message.edit_text("<b>–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–µ –∏–º—è</b>")
    await FSMregistration.name.set()
    await asyncio.sleep(300)
    if await state.get_state() == FSMregistration.name and 'name' not in (await state.get_data()).keys():
        await call.message.answer("–¢—É–∫-—Ç—É–∫, –∫–∞–∂–µ—Ç—Å—è –≤—ã –ø—Ä–µ—Ä–≤–∞–ª–∏—Å—å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é")

@dp.message_handler(Text("üí∏–û–ø–ª–∞—Ç–∞"))
async def payment_message(message: types.Message):
    await message.answer("""–û–ø–ª–∞—Ç–∞ –∑–∞ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–æ–≥–æ –º–µ—Å—è—Ü–∞ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫ 15-–º—É —á–∏—Å–ª—É —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ –≤—Å–µ —Ä–∞–±–æ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –≤ –æ–∫—Ç—è–±—Ä–µ, –æ–ø–ª–∞—Ç–∞ –±—É–¥–µ—Ç –ø–æ–¥—Å—á–∏—Ç–∞–Ω–∞ –∫ 15-–º—É –Ω–æ—è–±—Ä—è. 

15-–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –í–∞–º –Ω–∞ –ø–æ—á—Ç—É –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–∏—Å—å–º–æ, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑–∞–Ω–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å—É–º–º–∞ –∑–∞ –ø—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü. –°—Ä–æ–∫ –≤—ã–ø–ª–∞—Ç - –≤ —Ç–µ—á–µ–Ω–∏–µ 40 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ —Ä–∞—Å—Å—ã–ª–∫–∏ (—Å 15–≥–æ —á–∏—Å–ª–∞). 

–û–ø–ª–∞—Ç–∞ –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è —Ç—Ä–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π:

¬´–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π¬ª –Ω–∞ Qugo - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –Ω–∞–ª–æ–≥ 6% —É–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ,

¬´–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ¬ª –Ω–∞ Solar Staff - –æ–ø–ª–∞—Ç–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∑–∞ –≤—ã—á–µ—Ç–æ–º 7%

–ò–ü –Ω–∞ Solar Staff ‚Äì –Ω–∞–ª–æ–≥ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ª–æ–≥–æ–æ–±–ª–∞–∂–µ–Ω–∏—è –ò–ü""")

@dp.callback_query_handler(Text("cancel"), state="*")
async def cancel_action(call: types.CallbackQuery, state: FSMContext):
    await state.finish()
    await call.message.answer("<b>‚ùå–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ</b>")
    await call.message.delete()
